local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local vim = game:GetService("VirtualInputManager")
local camera = workspace.CurrentCamera
local runService = game:GetService("RunService")

-- GUI Setup
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "AutoFarmGUI"

local button = Instance.new("TextButton", gui)
button.Size = UDim2.new(0, 160, 0, 40)
button.Position = UDim2.new(0, 20, 0, 20)
button.BackgroundColor3 = Color3.fromRGB(200, 0, 0) -- ðŸ”´ Vermelho vibrante
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.GothamBold
button.TextSize = 16
button.Text = "Ativar Auto Farm"
button.BorderSizePixel = 0

-- Borda arredondada
local corner = Instance.new("UICorner", button)
corner.CornerRadius = UDim.new(0, 10)

-- Estado
local farming = false
local attackDelay = 0.15
local lastAttack = 0

-- PosiÃ§Ã£o do clique (centro da tela)
local x = camera.ViewportSize.X / 2
local y = camera.ViewportSize.Y / 2

-- FunÃ§Ã£o para encontrar o NPC mais prÃ³ximo
local function findTarget()
    local closest, dist = nil, math.huge
    for _, npc in pairs(workspace.Enemies:GetChildren()) do
        if npc:FindFirstChild("Humanoid") and npc:FindFirstChild("HumanoidRootPart") and npc.Humanoid.Health > 0 then
            local d = (npc.HumanoidRootPart.Position - char.HumanoidRootPart.Position).Magnitude
            if d < dist then
                closest = npc
                dist = d
            end
        end
    end
    return closest
end

-- FunÃ§Ã£o de ataque com teleporte + pose fixa + clique fÃ­sico
local function attack()
    if tick() - lastAttack < attackDelay then return end
    lastAttack = tick()

    local target = findTarget()
    if target and target:FindFirstChild("HumanoidRootPart") then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if hrp and humanoid then
            -- Pose fixa: barriga pra baixo
            humanoid:ChangeState(Enum.HumanoidStateType.Physics)
            hrp.CFrame = CFrame.new(target.HumanoidRootPart.Position + Vector3.new(0, 5, 0)) * CFrame.Angles(math.rad(90), 0, 0)
        end

        vim:SendMouseButtonEvent(x, y, 0, true, game, 0)
        task.wait(0.01)
        vim:SendMouseButtonEvent(x, y, 0, false, game, 0)
    end
end

-- Loop principal
runService.RenderStepped:Connect(function()
    if farming then
        attack()
    end
end)

-- BotÃ£o de toggle
button.MouseButton1Click:Connect(function()
    farming = not farming
    button.Text = farming and "Desativar Auto Farm" or "Ativar Auto Farm"
    button.BackgroundColor3 = farming and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(200, 0, 0)
end)
